<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stripe Payment</title>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <div id="payment-element"></div>
  <button class="pay-now">PAY NOW</button>

  <script>
    // Define an object to hold the payment status and message
    window.StripePaymentStatus = {
      status: null,
      message: null
    };

    // Function to get query parameters from URL
    function getQueryParam(param) {
      let params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

    // Get clientSecret from URL parameters
    const clientSecret = getQueryParam("client_secret");

    if (clientSecret) {
      const stripe = Stripe(
        "pk_test_51PgmWWJwumpIxqJ6XNpERy69SYGSo8f9q3RPtwQvSVFwMK2OmRQZ4qxysfr63Rr806dWdG6haWYsaToX7ozZR91n00KBw9jU6F"
      );

      const elements = stripe.elements({
        clientSecret: clientSecret,
      });

      const paymentElement = elements.create("payment");
      paymentElement.mount("#payment-element");

      document.querySelector(".pay-now").addEventListener("click", async () => {
        try {
            const { error, paymentIntent } = await stripe.confirmPayment({
            elements,
            confirmParams: {
              // Remove the top-level navigation URL to avoid sandbox issues
              return_url: "", // No redirection
            },
            redirect: "if_required", // Avoid any redirection
          });

          if (error) {
            // Update status on payment failure
            window.StripePaymentStatus.status = "failed";
            window.StripePaymentStatus.message = error.message;
            console.log("its in the if block");
            console.log(JSON.stringify(window.StripePaymentStatus));
          } else {
            // Update status on payment success
            window.StripePaymentStatus.status = "success";
            window.StripePaymentStatus.message = "Payment is successfully done";
            console.log("its in the success block");
            console.log(JSON.stringify(window.StripePaymentStatus));
          }
        } catch (err) {
          // Update status on error
          window.StripePaymentStatus.status = "failed";
          window.StripePaymentStatus.message = err.message;
          console.log("its in the catch block");
          console.log(JSON.stringify(window.StripePaymentStatus));
        }
      });
    } else {
    console.log("its in the elsee block");
      console.error("No client_secret found in URL");
    }

    // Expose the payment status to Flutter using this method
    window.getPaymentStatus = function() {
      return JSON.stringify(window.StripePaymentStatus);
    };
  </script>
</body>
</html>
